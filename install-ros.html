<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Install ROS - ROS Project 2024</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded "><a href="download-xilinx.html"><strong aria-hidden="true">1.</strong> Download Xlinix</a></li><li class="chapter-item expanded "><a href="install-ros.html" class="active"><strong aria-hidden="true">2.</strong> Install ROS</a></li><li class="chapter-item expanded "><a href="add-uart.html"><strong aria-hidden="true">3.</strong> Add UART</a></li><li class="chapter-item expanded "><a href="ros-proj-in-vitis.html"><strong aria-hidden="true">4.</strong> ROS project in vitis</a></li><li class="chapter-item expanded "><a href="gpio-n-interrupts.html"><strong aria-hidden="true">5.</strong> GPIO & Interrupts</a></li><li class="chapter-item expanded "><a href="new-vitis-proj.html"><strong aria-hidden="true">6.</strong> Create New Vitis Project</a></li><li class="chapter-item expanded "><a href="code-over-view.html"><strong aria-hidden="true">7.</strong> Code Over View</a></li><li class="chapter-item expanded "><a href="running.html"><strong aria-hidden="true">8.</strong> Running everthing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ROS Project 2024</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="install-ros-and-create-micro-ros-firmware-inside-ubuntu-2204"><a class="header" href="#install-ros-and-create-micro-ros-firmware-inside-ubuntu-2204">Install ROS and Create micro-ROS Firmware inside Ubuntu 22.04</a></h1>
<h2 id="install-ros-2"><a class="header" href="#install-ros-2">Install ROS 2</a></h2>
<p>Use the following link to download and set up ROS 2:<br />
<a href="https://docs.ros.org/en/humble/Installation/Ubuntu-Install-Debians.html">ROS 2 Installation Instructions</a></p>
<p>Follow these steps inside the page:</p>
<ol>
<li>
<p>Set locale (you can use the following to check if OS supports UTF-8 in your terminal)</p>
<pre><code class="language-bash">echo -e '\xe2\x82\xac'
</code></pre>
<p>if UTF-8 is supported it should print out euro symbol</p>
<pre><code class="language-bash">€
</code></pre>
</li>
<li>
<p>Setup Sources</p>
</li>
<li>
<p>Install ROS 2 packages</p>
</li>
<li>
<p>Environment setup</p>
</li>
</ol>
<h2 id="install-micro-ros-build-system"><a class="header" href="#install-micro-ros-build-system">Install micro-ROS Build System</a></h2>
<p>Now we need to create the micro-ROS build system.
The following steps were taken from (there is no need to use the link):<br />
<a href="https://micro.ros.org/docs/tutorials/core/first_application_rtos/freertos/">micro-ROS Build System Instructions</a></p>
<p>Make sure to replace <code>ROS_DISTRO</code> with the desired ROS version for us its "humble".</p>
<h3 id="source-the-ros-2-installation"><a class="header" href="#source-the-ros-2-installation">Source the ROS 2 Installation</a></h3>
<pre><code class="language-bash">source /opt/ros/$ROS_DISTRO/setup.bash
</code></pre>
<h3 id="create-a-workspace-and-download-the-micro-ros-tools"><a class="header" href="#create-a-workspace-and-download-the-micro-ros-tools">Create a Workspace and Download the micro-ROS Tools</a></h3>
<pre><code class="language-bash">mkdir microros_ws
cd microros_ws
git clone -b $ROS_DISTRO https://github.com/micro-ROS/micro_ros_setup.git src/micro_ros_setup
</code></pre>
<h3 id="update-dependencies-using-rosdep"><a class="header" href="#update-dependencies-using-rosdep">Update Dependencies Using rosdep</a></h3>
<pre><code class="language-bash">sudo apt update &amp;&amp; rosdep update
rosdep install --from-paths src --ignore-src -y
</code></pre>
<h3 id="install-pip"><a class="header" href="#install-pip">Install pip</a></h3>
<pre><code class="language-bash">sudo apt-get install python3-pip
</code></pre>
<h3 id="build-micro-ros-tools-and-source-them"><a class="header" href="#build-micro-ros-tools-and-source-them">Build micro-ROS Tools and Source Them</a></h3>
<pre><code class="language-bash">colcon build
source install/local_setup.bash
</code></pre>
<h2 id="create-firmware-for-the-microblaze"><a class="header" href="#create-firmware-for-the-microblaze">Create Firmware for the Microblaze</a></h2>
<p>Now we need to create the micro-ROS libraries.
The following steps were taken from (there is no need to use the link):<br />
<a href="https://micro.ros.org/docs/tutorials/advanced/create_custom_static_library/">Creating Custom Static Library Instructions</a></p>
<h3 id="run-the-following-command-and-create-the-firmware-directory"><a class="header" href="#run-the-following-command-and-create-the-firmware-directory">Run the Following Command and Create the Firmware Directory</a></h3>
<pre><code class="language-bash">ros2 run micro_ros_setup create_firmware_ws.sh generate_lib
</code></pre>
<h3 id="create-colcon-and-toolchain-files"><a class="header" href="#create-colcon-and-toolchain-files">Create colcon and Toolchain Files</a></h3>
<pre><code class="language-bash">touch my_custom_toolchain.cmake
touch my_custom_colcon.meta
</code></pre>
<p>Copy and paste from the supplied files into the created files.<br />
<a href="files/uROS/my_custom_colcon.meta">my_custom_colcon.meta</a><br />
<a href="files/uROS/my_custom_toolchain.cmake">my_custom_toolchain.cmake</a></p>
<p>Inside the Cmake file, change the following lines according to the correct Xilinx version.</p>
<pre><code class="language-bash"># SET HERE THE PATH TO YOUR C99 AND C++ COMPILERS
set(CMAKE_C_COMPILER /tools/Xilinx/Vitis/2022.2/gnu/microblaze/lin/bin/mb-gcc)
set(CMAKE_CXX_COMPILER /tools/Xilinx/Vitis/2022.2/gnu/microblaze/lin/bin/mb-g++)
</code></pre>
<p>Inside the colcon file, you can change the properties of the micro-ros (such as number of nodes)</p>
<pre><code class="language-bash">        "rmw_microxrcedds": {
            "cmake-args": [
                "-DRMW_UXRCE_MAX_NODES=1",
                "-DRMW_UXRCE_MAX_PUBLISHERS=5",
                "-DRMW_UXRCE_MAX_SUBSCRIPTIONS=5",
                "-DRMW_UXRCE_MAX_SERVICES=1",
                "-DRMW_UXRCE_MAX_CLIENTS=1",
                "-DRMW_UXRCE_MAX_HISTORY=4",
                "-DRMW_UXRCE_TRANSPORT=custom"
            ]
        },
</code></pre>
<h3 id="create-firmware--create-the-build-directory-and-a-file"><a class="header" href="#create-firmware--create-the-build-directory-and-a-file">Create Firmware – Create the Build Directory and .a File</a></h3>
<pre><code class="language-bash">ros2 run micro_ros_setup build_firmware.sh $(pwd)/my_custom_toolchain.cmake $(pwd)/my_custom_colcon.meta
</code></pre>
<h3 id="current-problems"><a class="header" href="#current-problems">Current Problems</a></h3>
<p><strong>Directory Structure</strong>:<br />
In one of the updates of ROS, the directory structure of the files changed.<br />
From:</p>
<pre><code class="language-cpp">#include &lt;rcl/rcl.h&gt;
</code></pre>
<p>To:</p>
<pre><code class="language-cpp">#include &lt;rcl/rcl/rcl.h&gt;
</code></pre>
<p>The problem is that the <code>#include</code> lines inside the files are not compatible with the new version.<br />
The current solution is to build the project and then to add links to each subdirectory needed so the compiler will see these directories as written in the includes (for example – add link to the first <code>rcl</code> directory).<br />
Wanted solution – probably a CMake file problem.
Current Solution: during the build of the code inside vitis, we will create links for the sub files (explained the the vitis chapter)</p>
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTQzMjk2OTYsLTEzMzgxODI4NTgsNzMwOT
k4MTE2XX0=
-->

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="download-xilinx.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="add-uart.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="download-xilinx.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="add-uart.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
